#!/bin/bash

# Exit on command errors and treat unset variables as an error
set -eu

# Load common variables and functions
source ./_common.sh

# Retrieve app settings
domain=$(ynh_app_setting_get "$app" domain)
path=$(ynh_app_setting_get "$app" path)
gogsrepo=$(ynh_app_setting_get "$app" gogsrepo)
is_public=$(ynh_app_setting_get "$app" is_public)

repo_path="/home/gogs/repositories/"$gogsrepo".git"

# Install the app
install_site $domain $path $gogsrepo $is_public

# Update the repo
sudo git --work-tree=$DESTDIR --git-dir=$repo_path checkout -f
sudo chown -R gogs:gogs $DESTDIR
